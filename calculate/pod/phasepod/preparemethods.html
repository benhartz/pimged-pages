<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pimged.calculate.pod.phasepod.preparemethods API documentation</title>
<meta name="description" content="Phase POD methods for preparing data." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:100%;max-height:10em;margin:auto;margin-bottom:.3em;margin-top:.3em}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pimged.calculate.pod.phasepod.preparemethods</code></h1>
</header>
<section id="section-intro">
<p>Phase POD methods for preparing data.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Phase POD methods for preparing data.&#34;&#34;&#34;

from os import path as ph, mkdir
from zarr import save as zarrsave, load as zarrload
import numpy as np

from ....calculate import Calculate
from ....datahandling.dataset import Dataset
from ....calculate.pod.generalrutines import PODInfo


def preparedata_calibration(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str):
    &#34;&#34;&#34;Ensure that the calibration data is loaded with the setup specified for the rutine.

    Parameters
    ----------
    mainpodinfo : PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
    &#34;&#34;&#34;
    print(&#39;Starting calibration part&#39;)

    # Checking if the calibration file exist
    checkcalifile = ph.join(folderlocation,
                            mainpodinfo.phasepodinfo.savename_preparecali)
    if ph.exists(checkcalifile + &#39;.pkl&#39;):
        print(&#39;calibration file exist, started loading&#39;)
        dataset.images.calibration.load(filepath=folderlocation,
                                        filename=mainpodinfo.phasepodinfo.savename_preparecali)
        print(&#39;Finished loading&#39;)

    else:
        # Creating the folder for saving the prepared data
        if ph.isdir(folderlocation):
            pass
        else:
            print(f&#39;making prepare data folder {folderlocation}&#39;)
            mkdir(folderlocation)

        dataset.loadimages(setfolderstoload=mainpodinfo.loaddatasets,
                           setimagestoload=mainpodinfo.datasetcalibimrange,
                           verb=True,
                           parset=True,
                           natkeysort=True)

        datacalc = Calculate(dataset)
        datacalc.bit2conccalib(numberofimages=mainpodinfo.calibrationimagestouse,
                               indivical=True,
                               parsetcalc=True)

        print(&#39;Saving calibration file&#39;)
        dataset.images.calibration.save(filepath=folderlocation,
                                        filename=mainpodinfo.phasepodinfo.savename_preparecali)
        print(&#39;Finished saving&#39;)


def preparedata_mean(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str, ampfac: int,
                     onlyload: bool = False):
    &#34;&#34;&#34;Calculate the mean dataset within the specified data range.

    The mean files are saved after calclation. Optimized for lower ram usage.
    Adjust the blocksizes for faster calculations, but more ram use.

    Parameters
    ----------
    mainpodinfo: PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
        
    ampfac : int :
        Amplification factor of the data
        
    onlyload : bool :
         (Default value = False)
        flag if rutine is used for loading data and not calculation

    Raises
    ------
    FileExistsError
        Mean files do not exist
    &#34;&#34;&#34;
    # Checking if the mean file exist
    checkmeanfile = ph.join(folderlocation,
                            mainpodinfo.phasepodinfo.savename_preparemean)
    if ph.isdir(checkmeanfile):
        print(&#39;mean file exist, started loading&#39;)
        dataset.images.mean.data = zarrload(
            ph.join(folderlocation,
                    mainpodinfo.phasepodinfo.savename_preparemean))
        print(&#39;Finished loading&#39;)

    elif not onlyload:
        mainpodinfo.framewidth = dataset.images.calibration.data.shape[1]
        mainpodinfo.frameheight = dataset.images.calibration.data.shape[0]

        poddim = mainpodinfo.framewidth * mainpodinfo.frameheight * mainpodinfo.phasepodinfo.time

        # Mean calculation matrix calculation
        tempmean = np.ones((mainpodinfo.frameheight,
                            mainpodinfo.framewidth,
                            mainpodinfo.phasepodinfo.time)) - 1

        counter = 1
        for i in range(mainpodinfo.datasetimagerange[0],
                       mainpodinfo.datasetimagerange[1]+mainpodinfo.phasepodinfo.blocksize_image,
                       mainpodinfo.phasepodinfo.blocksize_image):
            start = i
            end = i + mainpodinfo.phasepodinfo.blocksize_image - 1
            if end &gt; mainpodinfo.datasetimagerange[1]:
                end = mainpodinfo.datasetimagerange[1]

            if start &gt; end:
                break

            totalcounts = int(np.ceil(mainpodinfo.phasepodinfo.time /
                                      mainpodinfo.phasepodinfo.blocksize_image))
            print(f&#39;Loop {counter} of {totalcounts}, start = {i}   end = {end}&#39;)

            # Loading images
            dataset.loadimages(setfolderstoload=mainpodinfo.loaddatasets,
                               setimagestoload=[start, end],
                               verb=True,
                               parset=True,
                               natkeysort=True)

            # Converting data
            if counter == 1:
                datacalc = Calculate(dataset)
            else:
                pass

            datacalc.bit2conc()
            dataset.images.concentration.fliparraylr()

            if ampfac == 1:
                pass
            else:
                dataset.images.concentration.amplify(ampfac, uselims=False)

            # calculating the mean
            datacalc.mean()

            # Storing the mean in the temp container
            tempmean[:, :, start - mainpodinfo.datasetimagerange[0]:
                           end - mainpodinfo.datasetimagerange[0] + 1] = dataset.images.mean.data

            # increment loop counter
            counter += 1

        dataset.images.mean.data = tempmean
        dataset.images.mean.arrayinfo.loadedimagerange = mainpodinfo.datasetimagerange

        # Saving the mean data
        dataset.images.mean.data = dataset.images.mean.data.reshape(poddim, order=&#39;F&#39;)

        # Saving the data
        zarrsave(ph.join(folderlocation,
                         mainpodinfo.phasepodinfo.savename_preparemean),
                 dataset.images.mean.data)
    else:
        raise FileExistsError(&#39;The mean files do not exist. Create by running &#34;preparedata_mean&#34; &#39;
                              &#39;rutine&#39;)


def preparedata_concentration(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str,
                              ampfac: int):
    &#34;&#34;&#34;Load raw data in chunked setup and prepare it for the Phase POD calculations.

    Parameters
    ----------
    mainpodinfo: PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
        
    ampfac : int :
        Amplification factor of the data
    &#34;&#34;&#34;
    # Checking if the concentration dir exist
    checkconcdir = ph.join(folderlocation, mainpodinfo.phasepodinfo.savefolder_prepareconc)
    if ph.isdir(checkconcdir):
        pass
    else:
        print(f&#39;making concentration prepare data folder {checkconcdir}&#39;)
        mkdir(checkconcdir)

    mainpodinfo.framewidth = dataset.images.calibration.data.shape[1]
    mainpodinfo.frameheight = dataset.images.calibration.data.shape[0]

    poddim = mainpodinfo.framewidth * mainpodinfo.frameheight * mainpodinfo.phasepodinfo.time

    # calculation of concentration submatrices
    counter = 1
    for i in range(mainpodinfo.loaddatasets[0],
                   mainpodinfo.loaddatasets[1]+mainpodinfo.phasepodinfo.blocksize_dataset,
                   mainpodinfo.phasepodinfo.blocksize_dataset):
        start = i
        end = i + mainpodinfo.phasepodinfo.blocksize_dataset - 1
        if end &gt; mainpodinfo.loaddatasets[1]:
            end = mainpodinfo.loaddatasets[1]

        if start &gt; end:
            break

        totalcounts = int(np.ceil(mainpodinfo.phasepodinfo.phase /
                                  mainpodinfo.phasepodinfo.blocksize_dataset))
        print(f&#39;Loop {counter} of {totalcounts}, start = {i}   end = {end}&#39;)

        savename_conc = mainpodinfo.phasepodinfo.savename_prepareconc(start, end)

        # Loading images
        dataset.loadimages(setfolderstoload=[start, end],
                           setimagestoload=mainpodinfo.datasetimagerange,
                           verb=True,
                           parset=True,
                           natkeysort=True)

        # Converting data
        if counter == 1:
            datacalc = Calculate(dataset)
        else:
            pass

        datacalc.bit2conc(setrangeinput=[start - 1, end])
        dataset.images.concentration.fliparraylr()
        if ampfac == 1:
            pass
        else:
            dataset.images.concentration.amplify(ampfac, uselims=False)

        # Reshaping the concentration data
        print(&#39;Reshaping data&#39;)
        dataset.images.concentration.data = \
            dataset.images.concentration.data.reshape((poddim,
                                                       mainpodinfo.phasepodinfo.blocksize_dataset),
                                                      order=&#39;F&#39;)

        print(&#39;Subtrating mean&#39;)
        # Subtract the mean values
        dataset.images.concentration.data -= dataset.images.mean.data[:, np.newaxis]

        print(&#39;Saving the data&#39;)
        # Saving the submatrix data
        zarrsave(ph.join(checkconcdir, savename_conc), dataset.images.concentration.data)

        # increment loop counter
        counter += 1</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pimged.calculate.pod.phasepod.preparemethods.preparedata_calibration"><code class="name flex">
<span>def <span class="ident">preparedata_calibration</span></span>(<span>mainpodinfo: <a title="pimged.calculate.pod.generalrutines.podinfo.PODInfo" href="../generalrutines/podinfo.html#pimged.calculate.pod.generalrutines.podinfo.PODInfo">PODInfo</a>, dataset: <a title="pimged.datahandling.dataset.Dataset" href="../../../datahandling/dataset.html#pimged.datahandling.dataset.Dataset">Dataset</a>, folderlocation: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Ensure that the calibration data is loaded with the setup specified for the rutine.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>mainpodinfo</code></strong> :&ensp;<code>PODInfo :</code></dt>
<dd>POD object from the pod package</dd>
<dt><strong><code>dataset</code></strong> :&ensp;<code>Dataset :</code></dt>
<dd>dataset object from pimged package</dd>
<dt><strong><code>folderlocation</code></strong> :&ensp;<code>str :</code></dt>
<dd>the "prepare data" commen folder location for the framework</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def preparedata_calibration(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str):
    &#34;&#34;&#34;Ensure that the calibration data is loaded with the setup specified for the rutine.

    Parameters
    ----------
    mainpodinfo : PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
    &#34;&#34;&#34;
    print(&#39;Starting calibration part&#39;)

    # Checking if the calibration file exist
    checkcalifile = ph.join(folderlocation,
                            mainpodinfo.phasepodinfo.savename_preparecali)
    if ph.exists(checkcalifile + &#39;.pkl&#39;):
        print(&#39;calibration file exist, started loading&#39;)
        dataset.images.calibration.load(filepath=folderlocation,
                                        filename=mainpodinfo.phasepodinfo.savename_preparecali)
        print(&#39;Finished loading&#39;)

    else:
        # Creating the folder for saving the prepared data
        if ph.isdir(folderlocation):
            pass
        else:
            print(f&#39;making prepare data folder {folderlocation}&#39;)
            mkdir(folderlocation)

        dataset.loadimages(setfolderstoload=mainpodinfo.loaddatasets,
                           setimagestoload=mainpodinfo.datasetcalibimrange,
                           verb=True,
                           parset=True,
                           natkeysort=True)

        datacalc = Calculate(dataset)
        datacalc.bit2conccalib(numberofimages=mainpodinfo.calibrationimagestouse,
                               indivical=True,
                               parsetcalc=True)

        print(&#39;Saving calibration file&#39;)
        dataset.images.calibration.save(filepath=folderlocation,
                                        filename=mainpodinfo.phasepodinfo.savename_preparecali)
        print(&#39;Finished saving&#39;)</code></pre>
</details>
</dd>
<dt id="pimged.calculate.pod.phasepod.preparemethods.preparedata_concentration"><code class="name flex">
<span>def <span class="ident">preparedata_concentration</span></span>(<span>mainpodinfo: <a title="pimged.calculate.pod.generalrutines.podinfo.PODInfo" href="../generalrutines/podinfo.html#pimged.calculate.pod.generalrutines.podinfo.PODInfo">PODInfo</a>, dataset: <a title="pimged.datahandling.dataset.Dataset" href="../../../datahandling/dataset.html#pimged.datahandling.dataset.Dataset">Dataset</a>, folderlocation: str, ampfac: int)</span>
</code></dt>
<dd>
<div class="desc"><p>Load raw data in chunked setup and prepare it for the Phase POD calculations.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>mainpodinfo</code></strong> :&ensp;<code>PODInfo :</code></dt>
<dd>POD object from the pod package</dd>
<dt><strong><code>dataset</code></strong> :&ensp;<code>Dataset :</code></dt>
<dd>dataset object from pimged package</dd>
<dt><strong><code>folderlocation</code></strong> :&ensp;<code>str :</code></dt>
<dd>the "prepare data" commen folder location for the framework</dd>
<dt><strong><code>ampfac</code></strong> :&ensp;<code>int :</code></dt>
<dd>Amplification factor of the data</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def preparedata_concentration(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str,
                              ampfac: int):
    &#34;&#34;&#34;Load raw data in chunked setup and prepare it for the Phase POD calculations.

    Parameters
    ----------
    mainpodinfo: PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
        
    ampfac : int :
        Amplification factor of the data
    &#34;&#34;&#34;
    # Checking if the concentration dir exist
    checkconcdir = ph.join(folderlocation, mainpodinfo.phasepodinfo.savefolder_prepareconc)
    if ph.isdir(checkconcdir):
        pass
    else:
        print(f&#39;making concentration prepare data folder {checkconcdir}&#39;)
        mkdir(checkconcdir)

    mainpodinfo.framewidth = dataset.images.calibration.data.shape[1]
    mainpodinfo.frameheight = dataset.images.calibration.data.shape[0]

    poddim = mainpodinfo.framewidth * mainpodinfo.frameheight * mainpodinfo.phasepodinfo.time

    # calculation of concentration submatrices
    counter = 1
    for i in range(mainpodinfo.loaddatasets[0],
                   mainpodinfo.loaddatasets[1]+mainpodinfo.phasepodinfo.blocksize_dataset,
                   mainpodinfo.phasepodinfo.blocksize_dataset):
        start = i
        end = i + mainpodinfo.phasepodinfo.blocksize_dataset - 1
        if end &gt; mainpodinfo.loaddatasets[1]:
            end = mainpodinfo.loaddatasets[1]

        if start &gt; end:
            break

        totalcounts = int(np.ceil(mainpodinfo.phasepodinfo.phase /
                                  mainpodinfo.phasepodinfo.blocksize_dataset))
        print(f&#39;Loop {counter} of {totalcounts}, start = {i}   end = {end}&#39;)

        savename_conc = mainpodinfo.phasepodinfo.savename_prepareconc(start, end)

        # Loading images
        dataset.loadimages(setfolderstoload=[start, end],
                           setimagestoload=mainpodinfo.datasetimagerange,
                           verb=True,
                           parset=True,
                           natkeysort=True)

        # Converting data
        if counter == 1:
            datacalc = Calculate(dataset)
        else:
            pass

        datacalc.bit2conc(setrangeinput=[start - 1, end])
        dataset.images.concentration.fliparraylr()
        if ampfac == 1:
            pass
        else:
            dataset.images.concentration.amplify(ampfac, uselims=False)

        # Reshaping the concentration data
        print(&#39;Reshaping data&#39;)
        dataset.images.concentration.data = \
            dataset.images.concentration.data.reshape((poddim,
                                                       mainpodinfo.phasepodinfo.blocksize_dataset),
                                                      order=&#39;F&#39;)

        print(&#39;Subtrating mean&#39;)
        # Subtract the mean values
        dataset.images.concentration.data -= dataset.images.mean.data[:, np.newaxis]

        print(&#39;Saving the data&#39;)
        # Saving the submatrix data
        zarrsave(ph.join(checkconcdir, savename_conc), dataset.images.concentration.data)

        # increment loop counter
        counter += 1</code></pre>
</details>
</dd>
<dt id="pimged.calculate.pod.phasepod.preparemethods.preparedata_mean"><code class="name flex">
<span>def <span class="ident">preparedata_mean</span></span>(<span>mainpodinfo: <a title="pimged.calculate.pod.generalrutines.podinfo.PODInfo" href="../generalrutines/podinfo.html#pimged.calculate.pod.generalrutines.podinfo.PODInfo">PODInfo</a>, dataset: <a title="pimged.datahandling.dataset.Dataset" href="../../../datahandling/dataset.html#pimged.datahandling.dataset.Dataset">Dataset</a>, folderlocation: str, ampfac: int, onlyload: bool = False)</span>
</code></dt>
<dd>
<div class="desc"><p>Calculate the mean dataset within the specified data range.</p>
<p>The mean files are saved after calclation. Optimized for lower ram usage.
Adjust the blocksizes for faster calculations, but more ram use.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>mainpodinfo</code></strong> :&ensp;<code>PODInfo :</code></dt>
<dd>POD object from the pod package</dd>
<dt><strong><code>dataset</code></strong> :&ensp;<code>Dataset :</code></dt>
<dd>dataset object from pimged package</dd>
<dt><strong><code>folderlocation</code></strong> :&ensp;<code>str :</code></dt>
<dd>the "prepare data" commen folder location for the framework</dd>
<dt><strong><code>ampfac</code></strong> :&ensp;<code>int :</code></dt>
<dd>Amplification factor of the data</dd>
<dt><strong><code>onlyload</code></strong> :&ensp;<code>bool :</code></dt>
<dd>(Default value = False)
flag if rutine is used for loading data and not calculation</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>FileExistsError</code></dt>
<dd>Mean files do not exist</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def preparedata_mean(mainpodinfo: PODInfo, dataset: Dataset, folderlocation: str, ampfac: int,
                     onlyload: bool = False):
    &#34;&#34;&#34;Calculate the mean dataset within the specified data range.

    The mean files are saved after calclation. Optimized for lower ram usage.
    Adjust the blocksizes for faster calculations, but more ram use.

    Parameters
    ----------
    mainpodinfo: PODInfo :
        POD object from the pod package
        
    dataset: Dataset :
        dataset object from pimged package
        
    folderlocation : str :
        the &#34;prepare data&#34; commen folder location for the framework
        
    ampfac : int :
        Amplification factor of the data
        
    onlyload : bool :
         (Default value = False)
        flag if rutine is used for loading data and not calculation

    Raises
    ------
    FileExistsError
        Mean files do not exist
    &#34;&#34;&#34;
    # Checking if the mean file exist
    checkmeanfile = ph.join(folderlocation,
                            mainpodinfo.phasepodinfo.savename_preparemean)
    if ph.isdir(checkmeanfile):
        print(&#39;mean file exist, started loading&#39;)
        dataset.images.mean.data = zarrload(
            ph.join(folderlocation,
                    mainpodinfo.phasepodinfo.savename_preparemean))
        print(&#39;Finished loading&#39;)

    elif not onlyload:
        mainpodinfo.framewidth = dataset.images.calibration.data.shape[1]
        mainpodinfo.frameheight = dataset.images.calibration.data.shape[0]

        poddim = mainpodinfo.framewidth * mainpodinfo.frameheight * mainpodinfo.phasepodinfo.time

        # Mean calculation matrix calculation
        tempmean = np.ones((mainpodinfo.frameheight,
                            mainpodinfo.framewidth,
                            mainpodinfo.phasepodinfo.time)) - 1

        counter = 1
        for i in range(mainpodinfo.datasetimagerange[0],
                       mainpodinfo.datasetimagerange[1]+mainpodinfo.phasepodinfo.blocksize_image,
                       mainpodinfo.phasepodinfo.blocksize_image):
            start = i
            end = i + mainpodinfo.phasepodinfo.blocksize_image - 1
            if end &gt; mainpodinfo.datasetimagerange[1]:
                end = mainpodinfo.datasetimagerange[1]

            if start &gt; end:
                break

            totalcounts = int(np.ceil(mainpodinfo.phasepodinfo.time /
                                      mainpodinfo.phasepodinfo.blocksize_image))
            print(f&#39;Loop {counter} of {totalcounts}, start = {i}   end = {end}&#39;)

            # Loading images
            dataset.loadimages(setfolderstoload=mainpodinfo.loaddatasets,
                               setimagestoload=[start, end],
                               verb=True,
                               parset=True,
                               natkeysort=True)

            # Converting data
            if counter == 1:
                datacalc = Calculate(dataset)
            else:
                pass

            datacalc.bit2conc()
            dataset.images.concentration.fliparraylr()

            if ampfac == 1:
                pass
            else:
                dataset.images.concentration.amplify(ampfac, uselims=False)

            # calculating the mean
            datacalc.mean()

            # Storing the mean in the temp container
            tempmean[:, :, start - mainpodinfo.datasetimagerange[0]:
                           end - mainpodinfo.datasetimagerange[0] + 1] = dataset.images.mean.data

            # increment loop counter
            counter += 1

        dataset.images.mean.data = tempmean
        dataset.images.mean.arrayinfo.loadedimagerange = mainpodinfo.datasetimagerange

        # Saving the mean data
        dataset.images.mean.data = dataset.images.mean.data.reshape(poddim, order=&#39;F&#39;)

        # Saving the data
        zarrsave(ph.join(folderlocation,
                         mainpodinfo.phasepodinfo.savename_preparemean),
                 dataset.images.mean.data)
    else:
        raise FileExistsError(&#39;The mean files do not exist. Create by running &#34;preparedata_mean&#34; &#39;
                              &#39;rutine&#39;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<center><a class="homelink" rel="home" title="PImGED treat" href="https://youtu
.be/mx86-rTclzA?si=RWJEgJIT8MdOsVn7">
<img src="https://i.ibb.co/Tbp2rPk/logo.png" alt="">
</a></center>
</header>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pimged.calculate.pod.phasepod" href="index.html">pimged.calculate.pod.phasepod</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pimged.calculate.pod.phasepod.preparemethods.preparedata_calibration" href="#pimged.calculate.pod.phasepod.preparemethods.preparedata_calibration">preparedata_calibration</a></code></li>
<li><code><a title="pimged.calculate.pod.phasepod.preparemethods.preparedata_concentration" href="#pimged.calculate.pod.phasepod.preparemethods.preparedata_concentration">preparedata_concentration</a></code></li>
<li><code><a title="pimged.calculate.pod.phasepod.preparemethods.preparedata_mean" href="#pimged.calculate.pod.phasepod.preparemethods.preparedata_mean">preparedata_mean</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>