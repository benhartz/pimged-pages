<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pimged API documentation</title>
<meta name="description" content="![logo](https://i.ibb.co/5rdDr7p/header.png) …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:100%;max-height:10em;margin:auto;margin-bottom:.3em;margin-top:.3em}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>pimged</code></h1>
</header>
<section id="section-intro">
<p><img alt="logo" src="https://i.ibb.co/5rdDr7p/header.png"></p>
<p>Python Image library for GASMIX EUDP Distro (PImGED) is used for handling image data collected
during the experiments of the GASMIX project supported by EUDP, MAN ES and DTU. </p>
<p>The framework is designed to handle large amounts of image data with limited computational
resources. Several optimized function utilizing OpenCV C++, numba compilation and multithreading
through the Joblib package, are used to speed-up computations and memory handling.</p>
<p>GASMIX experiments consist of inverse seeded jet flows, where the environment is seeded and use
a jet of clean air for negative image. From the negative image a concentration is estimated
based on initial images before seeding and fully seeded. The PimGED package was designed to
handle these images on local computers with data on physical external harddrives.</p>
<hr>
<blockquote>
<p><strong>For more information, see the code pages &ndash;&gt; <a href="https://benhartz.github.io/pimged-pages/">found here</a> &lt;&ndash;</strong></p>
</blockquote>
<hr>
<h2 id="installation">Installation</h2>
<p>A test package is created for the project, and it is possible to install it, with dependencies
from testPyPi using the following command in the terminal for a Windows machine:</p>
<pre><code>python -m pip install --index-url https://test.pypi.org/simple/ --extra-index-url https://pypi.org/simple PImGed
</code></pre>
<hr>
<h2 id="example-tutorial-scripts-and-data">Example tutorial scripts and data</h2>
<p>To get the example scripts, clone this repo and set the working directory
inside the example folder. </p>
<pre><code class="language-commandline">git clone https://gitlab.gbar.dtu.dk/beakh/GASMIX-pimged.git
</code></pre>
<p>Further, external data is needed to use the examples</p>
<h3 id="download-the-example-data-from-this-figshare-link">Download the example data from this &ndash;&gt; <a href="https://figshare.com/s/286bc4cf871abd25b1d1">figshare link</a> &lt;&ndash;</h3>
<blockquote>
<p><strong>&ndash; OBS &ndash; &ndash; OBS &ndash; &ndash; OBS &ndash;</strong></p>
<p>The data folder is ~6 GB of data, as it consist of uncompressed tiff files directly from the
high-speed camera sensor used.</p>
</blockquote>
<hr>
<h3 id="extracted-folder-setup">Extracted folder setup</h3>
<p>In the example folder is located an example script on using the PImGED package and its modules.
The data folder contain 10 datasets obtained in the GASMIX test setup along with 10 pressure
measurments in a ziped folder for speed-up of downloading instead of many small image files.</p>
<p>Unzip the data folder so the folder path looks as seen here, and the <code>working directory</code>
should be set inside the example folder, with the scripts.</p>
<pre><code>pimged-example/
|   .gitignore
|   LICENSE
|   README.md
|
|-- example/
|       pimged_example.py
|       pimged_big_data_example.py
|       pimged_pod_example.py
|
`-- data/
    `-- data/
        `-- Pressure/
        |     ...
        `-- Pictures/
              ...
</code></pre>
<hr>
<h3 id="example-results">Example results</h3>
<p>All examples are designed so they should be able to run on most computeres of todays standard
with 16 GB of RAM. If less RAM is installed in the computer, there could be issues with running the
examples</p>
<h4 id="pimged_examplepy">pimged_example.py</h4>
<blockquote>
<p>Now it should be possible to run the <code>pimged_example.py</code> script for testing simple data
manangement and get these plots out. AVO translate to "After Valve Opening" and there is a delay
due to the air has to travel through the jet, valve opening delay and delay in the relays
sending the opening signal.</p>
<p><img src="https://i.ibb.co/DLsWmqR/jetconc.png" alt="drawing" width="800"/>
<img src="https://i.ibb.co/34msz0d/jetstatistics.png" alt="drawing" width="800"/>
<img src="https://i.ibb.co/zQ2xTgh/pressure.png" alt="drawing" width="500"/></p>
</blockquote>
<h4 id="pimged_big_data_examplepy">pimged_big_data_example.py</h4>
<blockquote>
<p>The <code>pimged_big_data_example.py</code> script show how to use the code for handling larger amounts
of data to get concentrations fields.
</p>
<p><strong>Running <code>pimged_big_data_example.py</code> stores ~8.7 GB of data on the hard drive</strong></p>
<p>The big data example should produce this plot</p>
<p><img src="https://i.ibb.co/mB6c003/bigdata.png" alt="drawing" width="800"/></p>
</blockquote>
<h4 id="pimged_pod_examplepy">pimged_pod_example.py</h4>
<blockquote>
<p>To use the POD calculation module, run <code>pimged_pod_example.py</code> for an example on use. This
example script takes some time to run, as it is an extensive algorithm.</p>
<p><strong>Running <code>pimged_pod_example.py</code> stores ~5.5 GB of data on the hard drive</strong></p>
<p>The following plot should be produced</p>
<p><img src="https://i.ibb.co/YDfFQPJ/phase-POD-mode-1.png" alt="drawing" width="500"/></p>
</blockquote>
<hr>
<h2 id="code-structure">Code structure</h2>
<p><img alt="codestructure" src="https://i.ibb.co/VDNfd9X/code-structure.png"></p>
<p>To handle larger data amounts the code takes inspiration from Panda on datastructure and
implement a dataset module used for loading/saving data. The data is handled by datacontainers
with functions for manipulating the individual datatypes. With the datacontainer module implementing
versatile classes for image and pressure datahandling, with common internal functions, it is
possible to reduce code repetition and adding datacontainers to the module. The metadata from
data is handled and stored for the individual dataset in the same datacontainer for and sent around
with the data. The dataset module object is then used as an input for other modules that can use
the standardrised data setup.</p>
<p>Handling standard calculations a calculation module takes the dataset object as an input.
When new information is calculated it can then populate the dataset object with information,
utilizing the indirection implementation of list and numpy arrays in python. This streamline the
collection of data in one object that can load or save the data with minimal coding.</p>
<p>Between the whole framework, several functions are reused with simple coding and these are
included in a utility package with the framework. Here is sorting of list elements widely used
in folder and filenames, checking folder paths, handling metadata etc. </p>
<p>Splitting the code framework into specialized modules decouple functionality and makes it
easy to update individual functionality in different modules, without breaking code coherence.</p>
<hr>
<h2 id="improvements">Improvements</h2>
<p>A re-write of the calculation module could improve useability with a design similar to that of
the POD module. The re-design would provide more flexibility and robustness of the code. And the
"jetparameters" module could be updated for the new code structure and made funcitioning again.</p>
<h2 id="future-work">Future work</h2>
<p>The package design makes it possible to implement new modules and functionalities fast. The POD
module only consist of a Phase POD rutine, but implementing a static POD or SPOD method could
improve useability. </p>
<h2 id="peer-review">Peer review</h2>
<p>There have been no feedback that is implemented in the code. All ideas in improvements is based on
learnings over coding the framework and learning to handle large datasets. </p>
<h2 id="tests">Tests</h2>
<p>The test setup is only done on some functions of the utils.utils module to show it is possible,
as full writing unittest for all functions and functionality of the PImGED package is a 3 month
project that is not time for. Further projects should include a unit test framework from the
start for reducing the workload over time and code updates checking.</p>
<hr>
<h2 id="support">Support</h2>
<p>The code is maintained during the GASMIX project from 2022 till start of 2025 by Benjamin Hartz</p>
<p>After project end there are no plans for further support of the code from main authors. </p>
<hr>
<h2 id="authors-and-acknowledgment">Authors and acknowledgment</h2>
<p>Created by Benjamin Hartz</p>
<p>Created during the GASMIX PhD project at DTU Construct under FVM, supported by EUPD and MAN ES </p>
<hr>
<h2 id="license">License</h2>
<p><a href="LICENSE">BSD 3-Clause License</a></p>
<p>Copyright (c) 2024, Benjamin Arnold Krekeler Hartz</p>
<hr>
<h2 id="quick-function-overview">Quick Function Overview</h2>
<p>These examples assume that <code><a title="pimged" href="#pimged">pimged</a></code> has been imported as <code>pg</code></p>
<pre><code class="language-python">    import pimged as pg
</code></pre>
<h3 id="load-raw-data">Load raw data</h3>
<p>The following creates a datahandling object with the working directory of the file folders,
<code>filedir</code>, a list of folders with image data that is searched in the natural sorted order,
<code>searchfolders</code>, and the zero particle folder with images without particles, <code>zeroparticlesfolder</code>.
It is possible to set <code>fullparticlesfolder</code>, which is a folder containing initial
images with particles. If this is set, the calibration function later will use this folder in the
calculations. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is adviced only to use <code>fullparticlesfolder</code>, if experienced with the package and datahandling</p>
</div>
<pre><code class="language-python">    image_path = &quot;C:\user\documents\imagefolder&quot;
    folderwithimages = [&quot;dataset1&quot;, &quot;dataset2&quot;, &quot;dataset3&quot;, .... , &quot;datasetN&quot;]
    zerofoldername = &quot;zero&quot;
    dataset = pg.Dataset(filedir=image_path, searchfolders=folderwithimages, zeroparticlesfolder=zerofoldername)
</code></pre>
<p>To load data there has to be called the <code>load</code> function within the <code>dataset.images.raw</code> object.
This load data into the raw image array object. If no input is given, all data is loaded. If the
setfolder is specified, the function load images from the searchfolders list based on the
position of the folder in the list. E.g. <code>[1, 5]</code> will load the first till the fifth folder, included.
The setimage specify how many of the images should be loaded from each folder. E.g. <code>[1, 600]</code> load
everything from first till the 600th image.</p>
<p>All data is saved into the Imagearray module under raw as a numpy ndarray with dimensions as
<code>[height, width, time, stationary time]</code></p>
<pre><code class="language-python">    dataset.loadimages(setfolderstoload=[1, 5], setimagestoload=[1, 600])
</code></pre>
<h3 id="calculate-concentration-fields">Calculate concentration fields</h3>
<p>To create a pixel to pixel, a calculation object using the <code>dataset</code> is created using:</p>
<pre><code class="language-python">    datacalc = pg.Calculate(dataset)
</code></pre>
<p>To do a calibration call the <code>bit2conccalib</code> function and specify how many initial pictures
should be used for the calibration. This function assume that <code>numberofimages</code> is present as the
first images in the dataset that can be used for calibration (<code>[1, numberofimages]</code>).
The function calculate a linear calibration per datasat given. Here a dataset is a folder of
images several image series</p>
<pre><code class="language-python">    datacalc.bit2conccalib(numberofimages=100)
</code></pre>
<p>To calculate the concentration from the raw images, use the <code>bit2conc</code> function under the calculate
module. It is possible to specify how much memory saving should be used during the calculations,
but is initally set as a parallized load with minimal memory saving.
All data is saved in the <code>dataset.images.concentration</code></p>
<pre><code class="language-python">    datacalc.bit2conc()
</code></pre>
<h3 id="calculate-statistics">Calculate statistics</h3>
<p>It is now possible to calculate statistics as the mean, standard diviation and variance with the
caluclate module. It is calculated along the stationary time dimension of the concentration data.
The data is saved into the <code>dataset.images</code> module under the array assigned the data type.</p>
<pre><code class="language-python">    datacalc.mean()
    datacalc.std()
    datacalc.var()
</code></pre>
<p>It is also possible to calculate e.g. the 4th moment of the data using </p>
<pre><code class="language-python">    nth_moment = datacalc.moment(nth=4)
</code></pre>
<p>This function return the calculated result and do not include it in the dataset object.</p>
<h3 id="saving-and-loading-data">Saving and loading data</h3>
<p>With the data in <code>dataset.images</code>, it is possible to save the data directly with builtin
functions. The given example save a mean data in the given savefolder <code>filepath</code> with
the save format defined by <code>fformat</code> using the <code>"zarr"</code> preset. The <code>filename</code> is the name of the
file. Zarr is a paralillazble compressed format that can be used for HPC datahandling and is faster
than usual .npz</p>
<pre><code class="language-python">    filename = &quot;data1&quot;
    savefolder = &quot;C:\user\documents\savefolder&quot;
    dataset.imagearrays.mean.save(filename=filename, filepath=savefolder, fformat=&quot;zarr&quot;)
</code></pre>
<p>To load the data the call to the load function inside the arrays is used. Here the <code>filepath</code> and
<code>fformat</code> is again specified and if the data is chunked saved, using <code>chunkeddata</code>. Chunked
meaning if the data is saved in several files for the same datahandling e.g. If the chunked
mode is on, the data looks for all data fitting in the mean array, find the indicies and load
the data based on the indicies for the data into the <code>dataset</code> object. All the data is organized
according to the metadata saved with the chunked mean data. E.g. if a data set is calculated
over 4 runs and saved in four files, splitting the calculated datasets timespan from <code>[1, 25]</code>,
<code>[26, 50]</code>, <code>[51, 75]</code> and <code>[76, 100]</code>, the code append the data into the same array going from
<code>[1, 100]</code>.</p>
<pre><code class="language-python">    dataset.imagearrays.mean.load(filename=filename, filepath=savefolder, fformat=&quot;zarr&quot;, chunkeddata=True)
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;

.. include:: ../readme.md

.. include:: ../documentation.md
&#34;&#34;&#34;
from .calculate.jetparameters import spreadangle, jetcenter
from .datahandling import Dataset
from .bigdata.bigdata import Bigdata
from .calculate import Calculate
from .calculate.pod import POD
from .imageexport import Imageexport
from .utils.chixread import checkingchixfileset
from .utils.naturalkeysort import naturalkeysort</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="pimged.bigdata" href="bigdata/index.html">pimged.bigdata</a></code></dt>
<dd>
<div class="desc"><p>Big data module …</p></div>
</dd>
<dt><code class="name"><a title="pimged.calculate" href="calculate/index.html">pimged.calculate</a></code></dt>
<dd>
<div class="desc"><p>Calculate module …</p></div>
</dd>
<dt><code class="name"><a title="pimged.datahandling" href="datahandling/index.html">pimged.datahandling</a></code></dt>
<dd>
<div class="desc"><p>Datahandling module …</p></div>
</dd>
<dt><code class="name"><a title="pimged.imageexport" href="imageexport/index.html">pimged.imageexport</a></code></dt>
<dd>
<div class="desc"><p>Imageexport module …</p></div>
</dd>
<dt><code class="name"><a title="pimged.utils" href="utils/index.html">pimged.utils</a></code></dt>
<dd>
<div class="desc"><p>Utils module …</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<center><a class="homelink" rel="home" title="PImGED treat" href="https://youtu
.be/mx86-rTclzA?si=RWJEgJIT8MdOsVn7">
<img src="https://i.ibb.co/Tbp2rPk/logo.png" alt="">
</a></center>
</header>
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#example-tutorial-scripts-and-data">Example tutorial scripts and data</a><ul>
<li><a href="#download-the-example-data-from-this-figshare-link">Download the example data from this &ndash;&gt; figshare link &lt;&ndash;</a></li>
<li><a href="#extracted-folder-setup">Extracted folder setup</a></li>
<li><a href="#example-results">Example results</a><ul>
<li><a href="#pimged_examplepy">pimged_example.py</a></li>
<li><a href="#pimged_big_data_examplepy">pimged_big_data_example.py</a></li>
<li><a href="#pimged_pod_examplepy">pimged_pod_example.py</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#code-structure">Code structure</a></li>
<li><a href="#improvements">Improvements</a></li>
<li><a href="#future-work">Future work</a></li>
<li><a href="#peer-review">Peer review</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#support">Support</a></li>
<li><a href="#authors-and-acknowledgment">Authors and acknowledgment</a></li>
<li><a href="#license">License</a></li>
<li><a href="#quick-function-overview">Quick function overview</a><ul>
<li><a href="#load-raw-data">Load raw data</a></li>
<li><a href="#calculate-concentration-fields">Calculate concentration fields</a></li>
<li><a href="#calculate-statistics">Calculate statistics</a></li>
<li><a href="#saving-and-loading-data">Saving and loading data</a></li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="pimged.bigdata" href="bigdata/index.html">pimged.bigdata</a></code></li>
<li><code><a title="pimged.calculate" href="calculate/index.html">pimged.calculate</a></code></li>
<li><code><a title="pimged.datahandling" href="datahandling/index.html">pimged.datahandling</a></code></li>
<li><code><a title="pimged.imageexport" href="imageexport/index.html">pimged.imageexport</a></code></li>
<li><code><a title="pimged.utils" href="utils/index.html">pimged.utils</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>